<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Official Complete NBBO tables &mdash; pytaq 0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Trade-NBBO tables" href="trade%20nbbo%20tables.html" />
    <link rel="prev" title="Trade tables" href="trade%20tables.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> pytaq
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Creatting TaqDaliy object</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="connecting.html">Connecting to database</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Data</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="nbbo%20symbols.html">NBBO symbols</a></li>
<li class="toctree-l1"><a class="reference internal" href="nbbo%20tables.html">NBBO tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="quote%20tables.html">Qoute tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="trade%20tables.html">Trade tables</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Official Complete NBBO tables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="trade%20nbbo%20tables.html">Trade-NBBO tables</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Processing Data</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="spreads.html">Spreads</a></li>
<li class="toctree-l1"><a class="reference internal" href="averages.html">Averages</a></li>
<li class="toctree-l1"><a class="reference internal" href="effective%20spreads.html">Effective Spreads</a></li>
<li class="toctree-l1"><a class="reference internal" href="realized%20spreads%20%26%20price%20impact.html">Realized Spreads &amp; Price Impact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pytaq</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Official Complete NBBO tables</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/official complete nbbo tables.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="official-complete-nbbo-tables">
<h1>Official Complete NBBO tables<a class="headerlink" href="#official-complete-nbbo-tables" title="Permalink to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="TaqDaliy.get_official_complete_nbbo">
<span class="sig-prename descclassname"><span class="pre">TaqDaliy.</span></span><span class="sig-name descname"><span class="pre">get_official_complete_nbbo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">date</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbbo_df</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quote_df</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#TaqDaliy.get_official_complete_nbbo" title="Permalink to this definition"></a></dt>
<dd><p>Return Official Complete NBBO (National Best Bid and Offer) table for given symbols at specific date during normal quoting hours.
The nbbo file is incomplete by itself (if a single exchange has the best bid and offer, the quote is included in the quotes file, but not the nbbo file). To create the complete official nbbo, we need to merge with the quotes file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>date</strong> (<em>datetime instance</em>) – Day that market was open at it.</p></li>
<li><p><strong>symbols</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – Symbols that data is related to it.</p></li>
<li><p><strong>nbbo_df</strong><strong>(</strong><strong>quote_df</strong><strong>)</strong> (<em>Pandas DataFrame</em>) – If both <code class="docutils literal notranslate"><span class="pre">nbbo_df</span></code> and <code class="docutils literal notranslate"><span class="pre">quote_df</span></code> are provided, retreive Offical NBBO by merging them together (local files), otherwise get it directly from database.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Official Complete NBBO.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Pandas DataFrame</p>
</dd>
</dl>
</dd></dl>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are using local files, beware to set option <code class="docutils literal notranslate"><span class="pre">nbbo_only=True</span></code> when getting <a class="reference internal" href="quote%20tables.html#quote"><span class="std std-ref">quote_df</span></a></p>
</div>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading"></a></h2>
<p><strong>Example 1:</strong> get Offical Complete NBBO directly from database.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pytaq</span> <span class="kn">import</span> <span class="n">TaqDaily</span>
<span class="kn">import</span> <span class="nn">wrds</span>

<span class="c1"># connecting to WRDS database, use your username instead of &#39;username&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">wrds_username</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
<span class="n">taq</span> <span class="o">=</span> <span class="n">TaqDaily</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">)</span>

<span class="c1"># getting official complete NBBO table using taqdaily instance</span>
<span class="n">off_nbbo_df</span> <span class="o">=</span> <span class="n">taq</span><span class="o">.</span><span class="n">get_official_complete_nbbo</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;IBM&#39;</span><span class="p">])</span>
<span class="n">off_nbbo_df</span>
</pre></div>
</div>
<p><strong>Example 2:</strong> retreive Offical Complete NBBO from local DataFrames.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pytaq</span> <span class="kn">import</span> <span class="n">TaqDaily</span>
<span class="kn">import</span> <span class="nn">wrds</span>

<span class="c1"># connecting to WRDS database, use your username instead of &#39;username&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">wrds</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">wrds_username</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
<span class="n">taq</span> <span class="o">=</span> <span class="n">TaqDaily</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;PostgreSQL&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">)</span>

<span class="c1"># getting nbbo table and quote table, but you can use local files</span>
<span class="n">nbbo_df</span> <span class="o">=</span> <span class="n">taq</span><span class="o">.</span><span class="n">get_nbbo_table</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;IBM&#39;</span><span class="p">])</span>
<span class="n">quote_df</span> <span class="o">=</span> <span class="n">taq</span><span class="o">.</span><span class="n">get_quote_table</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;IBM&#39;</span><span class="p">])</span>

<span class="c1"># getting official complete NBBO table using taqdaily instance</span>
<span class="n">off_nbbo_df</span> <span class="o">=</span> <span class="n">taq</span><span class="o">.</span><span class="n">get_official_complete_nbbo</span><span class="p">(</span><span class="n">nbbo_df</span><span class="o">=</span><span class="n">nbbo_df</span><span class="p">,</span> <span class="n">quote_df</span><span class="o">=</span><span class="n">quote_df</span><span class="p">)</span>
<span class="n">off_nbbo_df</span>
</pre></div>
</div>
<p>Both methods have the same output. The first few lines of the output file look like this:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>symbol</p></th>
<th class="head"><p>timestamp</p></th>
<th class="head"><p>best_bid</p></th>
<th class="head"><p>best_bidsizeshares</p></th>
<th class="head"><p>best_bidex</p></th>
<th class="head"><p>best_ask</p></th>
<th class="head"><p>best_asksizeshares</p></th>
<th class="head"><p>best_askex</p></th>
<th class="head"><p>qu_seqnum</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IBM</p></td>
<td><p>2016-12-07 09:00:05.396923</p></td>
<td><p>159.69</p></td>
<td><p>300.0</p></td>
<td><p>P</p></td>
<td><p>160.20</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>426557</p></td>
</tr>
<tr class="row-odd"><td><p>IBM</p></td>
<td><p>2016-12-07 09:00:05.396947</p></td>
<td><p>159.69</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>160.20</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>426558</p></td>
</tr>
<tr class="row-even"><td><p>IBM</p></td>
<td><p>2016-12-07 09:00:05.398795</p></td>
<td><p>159.71</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>160.20</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>426561</p></td>
</tr>
<tr class="row-odd"><td><p>IBM</p></td>
<td><p>2016-12-07 09:00:10.397634</p></td>
<td><p>159.67</p></td>
<td><p>1300.0</p></td>
<td><p>P</p></td>
<td><p>160.20</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>426846</p></td>
</tr>
<tr class="row-even"><td><p>IBM</p></td>
<td><p>2016-12-07 09:00:10.399425</p></td>
<td><p>159.70</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>160.20</p></td>
<td><p>100.0</p></td>
<td><p>P</p></td>
<td><p>426849</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="trade%20tables.html" class="btn btn-neutral float-left" title="Trade tables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="trade%20nbbo%20tables.html" class="btn btn-neutral float-right" title="Trade-NBBO tables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Vincent Grégoire.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>